<div class="container">
  <aside>
    <ul>
      <li><%= type_filter_link "All" %></li>
      <li><%= type_filter_link "HTTP", "http" %></li>
      <li><%= type_filter_link "Playwright", "playwright" %></li>
      <li><%= type_filter_link "SMTP", "smtp" %></li>
      <li><%= type_filter_link "Traceroute", "traceroute" %></li>
    </ul>
  </aside>

  <main>
    <h1>Probe Results</h1>
    <p><%= results_summary(@page) %></p>

    <div class="filters">
      <%= form_with url: main_app.host_root_path, method: :get, data: { controller: "auto-submit" } do |f| %>
        <%= hidden_field_tag :probe_type, params[:probe_type] if params[:probe_type].present? %>
        <label for="status">Status</label>
        <%= select_tag :status,
              options_for_select([["All", ""]] + Upright::ProbeResult.statuses.keys.map { |s| [s.titleize, s] }, params[:status]),
              class: "input--select",
              data: { action: "change->auto-submit#submit" } %>
        <label for="probe_name">Name</label>
        <%= select_tag :probe_name,
              options_for_select([["All", ""]] + @probe_names, params[:probe_name]),
              class: "input--select",
              data: { action: "change->auto-submit#submit" } %>
      <% end %>
    </div>

    <div class="probe-results-chart"
         data-controller="probe-results-chart"
         data-probe-results-chart-results-value="<%= @chart_data.to_json %>">
    </div>

    <table>
      <thead>
        <tr>
          <th>Probe Name</th>
          <th>Status</th>
          <th>Duration</th>
          <th>Created At</th>
          <th>Artifacts</th>
        </tr>
      </thead>
      <tbody>
        <% @page.records.each do |result| %>
          <tr>
            <td><%= probe_type_icon(result.probe_type) %> <%= result.probe_name %></td>
            <td class="status-<%= result.status %>"><%= result.status.titleize %></td>
            <td><%= result.duration ? "#{sprintf('%.3f', result.duration)}s" : "N/A" %></td>
            <td title="<%= result.created_at.to_fs(:db) %>"><%= time_ago_in_words(result.created_at) %> ago</td>
            <td>
              <%= render result.artifacts %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%= render "pagination", page: @page %>
  </main>
</div>
